# 体验文档
> 主要是记录文档阅读过程中的一些收获和最终产品体验上的建议 by lingowen（温俊杰）

## 文档收获
首先是架构方面：
主要是助学业务的架构
1. 客户端、H5、小程序端
2. 业务网关
3. 服务层
4. 中间层
    - Kafka
    - ES
    - 敏感词检测
5. 存储层面
    - Redis
    - MYSQL
    - MongoDB

在文档中记录的问题的解决方案，有一些收获，同时记录一些思考方向：
- 对于高并发场景（考试参与人数的并发修改造成锁抢占），数据先不落库，先写入缓存，通过异步Task完成后续落库操作或者约定时间定期落库，准确性通过补偿校验保障（具体又是怎么做的？）
- 如何解决修改题目后重新计算分数导致的写扩散问题？（一道题目能关联多个考试，一场考试有多人参与，这就导致修改题目之后要修改的考试得分数据量较大，大顾客在修改其题目后，关联的分数无法及时变化，有30min到1h的延迟）
    1. 增加消费者数量分区，由一个调整为4个
    2. 修改消费脚本逻辑，增加批量、并发消费，每批100个，每次10个并发计算，预估延迟时间能减少到10s左右
- 由于基因法的分表规则和几个使用量较大的店铺存在，导致部分表数据分布极不均匀，慢SQL影响打卡系统稳定性（文档中还没有看到实际是怎么解决的，下面是DS的回答提取）
    1. 调整分表策略为更均匀的一致性哈希或者CRC32（具体如何操作？调整后受影响的数据查询如何进行路由？似乎是像HashMap扩容之后做一些数据的重映射，是否可行呢？中途应该注意什么？）
    2. 迁移比较久远的历史数据到归档表，减少主表数据量（数据迁移需要注意些什么？如何防止迁移数据的过程阻塞其他数据库请求？）
- B端口打卡日记优先查询基础的ES服务，ES服务失败会走兜底查询DB
- 游标如何优化性能？具体是怎么做的？

## 体验建议
1. （这个在最新去查看的时候已经被修改了...太高效了hh）【系列课】->【课程目录】-> 已添加的小节虽然可以加入到后添加的章节中，但是需要通过【批量操作】->【批量移动】，个人认为相对繁琐，是否可以以（批量选择）拖动的形式移动较为符合直觉
2. 【服务】-》【用户管理】-》【用户列表】-》【用户详情】-》【黑名单设置】点击禁止评论（或任意一个），然后会出来一个弹窗（A），但是这个弹窗出来之后，用户依旧可以点击【禁止评论】（B）【禁止购买】（C）【禁止访问】（D），在弹窗（A）结束之前，操作BCD不会有反应，但是A结束之后，BCD会一起出来...如果这不是有意设计的，也许在A出来后加个遮罩会好一些（但真的有人会这么操作吗hh）
3. 【内容】-》【圈子】-》【圈子管理】-》【动态详情】这里的楼中楼【xx回复xx】后续紧跟着是时间（这里应该是组件复用导致的hh）。个人感觉目前内容不是那么清晰，【xx回复xx】后面紧跟着内容可能会比较清晰一些，而且内容的字号相比其他有些稍小~。在输入框获得焦点的时候回车发送（Ctrl + 回车换行）会不会更符合多数用户习惯（原因是微信是这样的）呢?（但目前已经是回车换行了，如果用户已经养成了回车换行的习惯，或许忽略这一点也无所谓）
4. 【内容】-》【互动管理】-》【运营设置】这里开启引流设置了以后，信息采集部分的选项会被底边栏遮住一半，而且整个页面是无法下拉的。
5. 【内容】-》【互动管理】-》【付费问答】这里的排序功能和第一点是类似的~ 并不直观
6. 【服务】模块切换左边栏有概率出现：
